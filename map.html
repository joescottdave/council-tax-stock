<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Council Tax Fun Times</title>
        
        <meta charset="UTF-8" />
        <meta name="author" content="c1554527" />

        <link rel="stylesheet" type="text/css" href="./css/map.css" />

        <style>
        .circle {
            fill: steelblue;
            fill-opacity: .8;
            stroke: #fff;
        }
        </style>

    </head>
    <body>

        <!-- explanatory stuff -->
        <header>
            <h1>Council Tax Fun Times</h1>

            <div id="info">
            </div>
        </header>

        <!-- visualisation container -->
        <div id="vis">

        </div>

        <!-- javascript -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.20/topojson.min.js"></script>

        <!-- visualisation js -->
        <script>
            var width;
            var height;

            var svg;
            var g;

            var projection;
            var path;

            var tax_data;
            var tax_data_object = new Object;

            function draw(lad_bounds) {
                projection
                    .scale(1)
                    .translate([0,0]);

                var b = path.bounds(topojson.feature(lad_bounds, lad_bounds.objects['lad']));
                var s = .95/Math.max((b[1][0] - b[0][0])/width, (b[1][1] - b[0][1])/height);
                var t = [(width - s * (b[1][0] + b[0][0]))/2, (height - s*(b[1][1] + b[0][1]))/2];

                projection
                    .scale(s)
                    .translate(t);

                var areas = g.selectAll(".area")
                    .data(topojson.feature(lad_bounds, lad_bounds.objects['lad']).features);

                areas
                    .enter()
                    .append('path')
                    .attr('class', 'area')
                    .attr('id', function(d) { d.id; })
                    .attr('d', path)
                    .on("click", function(d) {console.log(d.id)});
            }

            function init() {
                width = document.getElementById("vis").clientWidth;
                height = document.getElementById("vis").clientHeight;

                svg = d3.select("#vis")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
                
                g = svg.append("g");

                projection = d3.geo.albers()
                    .rotate([0,0]);

                path = d3.geo.path()
                    .projection(projection);

                queue()
                    .defer(d3.json, "./geoJSON/topo_lad.json")
                    .defer(d3.csv, "./data/ctsop2016.csv")
                    .defer(d3.csv, "./data/ctsop2015.csv")
                    .await(function(error, boundaries, ctsop2016, ctsop2015){
                        console.log(ctsop2015);
                        console.log(ctsop2016);
                        tax_data = ctsop2016;
                        console.log(boundaries);
                        draw(boundaries);
                    })
            }

            init();            

                   
                    // // Function for filling areas for chloropleth
                    // .attr('fill', function(d){
                    //     for(var i = 0; i < tax_data.length; i++){
                    //         if(tax_data[i].ECODE === d.id){
                    //             var key = Math.round(
                    //                 (parseInt(tax_data[i].BAND_B.replace(',','')) / parseInt(tax_data[i].ALL_PROPERTIES.replace(',','')))*100
                    //                 )
                    //             console.log(tax_data[i].AREA_NAME, key)
                    //             return colorThing(key)
                    //         }
                    //     }
                    //     console.log('boo');
                    //     return '#eeeeee';
                    // })
                    // var colorThing = d3.scale.linear()
                    //     .domain([0,100])
                    //     .range(["#FF0000", "#0000FF"]);

                    // var colors = {
                    //     "A": "#FF0000",
                    //     "B": "#CC4400",
                    //     "C": "#998800",
                    //     "D": "#44CC00",
                    //     "E": "#00FF00",
                    //     "F": "#00CC44",
                    //     "G": "#009988",
                    //     "H": "#0044CC",
                    //     "I": "#0000FF",
                    // };
        </script>
    </body>
</html>